//@version=6
indicator("Market Ratio Selector v1", "SR-v1", precision = 2)

// ========================================
// INPUT PARAMETERS
// ========================================
// Column headers displayed as info
sValueHeader = input.string("Value", "", group="Ratios to Display", inline="header1")
sGrowthHeader = input.string("Growth", "", group="Ratios to Display", inline="header1")

bShowSPYQQQ = input.bool(false, "SPY : QQQ", group="Ratios to Display")
bShowXLPXLY = input.bool(false, "XLP : XLY", group="Ratios to Display")
bShowIWDIWF = input.bool(false, "IWD : IWF (Russell 1000)", group="Ratios to Display")
bShowSPYDJUSSC = input.bool(false, "SPY : DJUSSC (Semiconductors)", group="Ratios to Display")
bShowSPYVSPYG = input.bool(false, "SPYV : SPYG (S&P 500)", group="Ratios to Display")
bShowMDYVMDYG = input.bool(false, "MDYV : MDYG (S&P 400)", group="Ratios to Display")
bShowIJSIJT = input.bool(false, "IJS : IJT (S&P 600)", group="Ratios to Display")
bShowIWNIWO = input.bool(false, "IWN : IWO (Russell 2000)", group="Ratios to Display")
bShowDJUDJT = input.bool(false, "DJU : DJT (Utility vs Transport)", group="Ratios to Display")

// Custom Ratio Settings
bShowCustom = input.bool(false, "Show Custom Ratio", group="Custom Ratio")
sCustomNum = input.string("SPY", "Numerator", options=["SPY", "QQQ", "XLP", "XLY", "IWD", "IWF", "DJU", "DJT", "DJUSSC", "SPYV", "SPYG", "MDYV", "MDYG", "IJS", "IJT", "IWN", "IWO"], group="Custom Ratio")
sCustomDen = input.string("QQQ", "Denominator", options=["SPY", "QQQ", "XLP", "XLY", "IWD", "IWF", "DJU", "DJT", "DJUSSC", "SPYV", "SPYG", "MDYV", "MDYG", "IJS", "IJT", "IWN", "IWO"], group="Custom Ratio")

iSma = input.int(55, "SMA", display=display.none)
bShowSMA = input.bool(true, "Show SMA Lines")
bShowLabels = input.bool(true, "Show Ratio Labels", tooltip="Display ratio labels at the right edge of the chart")
sLabelSize = input.string("small", "Label Size", options=["tiny", "small", "normal", "large", "huge"], tooltip="Size of the ratio labels")
sLabelStyle = input.string("left", "Label Position", options=["left", "right"], tooltip="Position relative to the bar (Left=Text to the right of anchor)")
bInverseRatios = input.bool(false, "Inverse Ratios (Growth / Value)", tooltip="When enabled, flips all ratios (e.g., QQQ/SPY instead of SPY/QQQ)")

// Gap Adjustment Settings
bWithoutGaps = input.bool(false, "Without Gaps", group="Gap Adjustment", tooltip="Calculate prices without overnight gaps from the start date")
gapStartDate = input.time(timestamp("01 Jan 2024 00:00 +0000"), "Gap Adjustment Start Date", group="Gap Adjustment", tooltip="Start calculating gap-free prices from this date forward")

// ========================================
// PRICE DATA RETRIEVAL
// ========================================
// SPY:QQQ
spyClose = request.security(ticker.new("", "SPY", session=session.regular), timeframe.period, close)
spyOpen = request.security(ticker.new("", "SPY", session=session.regular), timeframe.period, open)
qqqClose = request.security(ticker.new("", "QQQ", session=session.regular), timeframe.period, close)
qqqOpen = request.security(ticker.new("", "QQQ", session=session.regular), timeframe.period, open)

// XLP:XLY
xlpClose = request.security(ticker.new("", "XLP", session=session.regular), timeframe.period, close)
xlpOpen = request.security(ticker.new("", "XLP", session=session.regular), timeframe.period, open)
xlyClose = request.security(ticker.new("", "XLY", session=session.regular), timeframe.period, close)
xlyOpen = request.security(ticker.new("", "XLY", session=session.regular), timeframe.period, open)

// IWD:IWF
iwdClose = request.security(ticker.new("", "IWD", session=session.regular), timeframe.period, close)
iwdOpen = request.security(ticker.new("", "IWD", session=session.regular), timeframe.period, open)
iwfClose = request.security(ticker.new("", "IWF", session=session.regular), timeframe.period, close)
iwfOpen = request.security(ticker.new("", "IWF", session=session.regular), timeframe.period, open)

// DJU:DJT
djuClose = request.security(ticker.new("", "DJU", session=session.regular), timeframe.period, close)
djuOpen = request.security(ticker.new("", "DJU", session=session.regular), timeframe.period, open)
djtClose = request.security(ticker.new("", "DJT", session=session.regular), timeframe.period, close)
djtOpen = request.security(ticker.new("", "DJT", session=session.regular), timeframe.period, open)

// DJUSSC (Dow Jones U.S. Semiconductors)
djusscClose = request.security(ticker.new("", "DJUSSC", session=session.regular), timeframe.period, close)
djusscOpen = request.security(ticker.new("", "DJUSSC", session=session.regular), timeframe.period, open)

// SPYV:SPYG (S&P 500)
spyvClose = request.security(ticker.new("", "SPYV", session=session.regular), timeframe.period, close)
spyvOpen = request.security(ticker.new("", "SPYV", session=session.regular), timeframe.period, open)
spygClose = request.security(ticker.new("", "SPYG", session=session.regular), timeframe.period, close)
spygOpen = request.security(ticker.new("", "SPYG", session=session.regular), timeframe.period, open)

// MDYV:MDYG (S&P 400)
mdyvClose = request.security(ticker.new("", "MDYV", session=session.regular), timeframe.period, close)
mdyvOpen = request.security(ticker.new("", "MDYV", session=session.regular), timeframe.period, open)
mdygClose = request.security(ticker.new("", "MDYG", session=session.regular), timeframe.period, close)
mdygOpen = request.security(ticker.new("", "MDYG", session=session.regular), timeframe.period, open)

// IJS:IJT (S&P 600)
ijsClose = request.security(ticker.new("", "IJS", session=session.regular), timeframe.period, close)
ijsOpen = request.security(ticker.new("", "IJS", session=session.regular), timeframe.period, open)
ijtClose = request.security(ticker.new("", "IJT", session=session.regular), timeframe.period, close)
ijtOpen = request.security(ticker.new("", "IJT", session=session.regular), timeframe.period, open)

// IWN:IWO (Russell 2000)
iwnClose = request.security(ticker.new("", "IWN", session=session.regular), timeframe.period, close)
iwnOpen = request.security(ticker.new("", "IWN", session=session.regular), timeframe.period, open)
iwoClose = request.security(ticker.new("", "IWO", session=session.regular), timeframe.period, close)
iwoOpen = request.security(ticker.new("", "IWO", session=session.regular), timeframe.period, open)

// Custom Ratio Data
customNumClose = request.security(ticker.new("", sCustomNum, session=session.regular), timeframe.period, close)
customNumOpen = request.security(ticker.new("", sCustomNum, session=session.regular), timeframe.period, open)
customDenClose = request.security(ticker.new("", sCustomDen, session=session.regular), timeframe.period, close)
customDenOpen = request.security(ticker.new("", sCustomDen, session=session.regular), timeframe.period, open)

// ========================================
// GAP ADJUSTMENT LOGIC
// ========================================
// Function to calculate gap-adjusted price
f_gapAdjustedPrice(float closePrice, float openPrice, bool enableGaps, int startDate) =>
    var float cumulativeGap = 0.0
    var float prevClose = na

    // Detect new day (approximation: when open != previous close)
    bool newDay = not na(prevClose) and not na(openPrice) and math.abs(openPrice - prevClose) > 0.001

    // Calculate gap if we're past the start date and gaps are enabled
    if enableGaps and time >= startDate and newDay
        float gap = openPrice - prevClose
        cumulativeGap += gap

    // Update previous close for next iteration
    prevClose := closePrice

    // Return adjusted or original price
    float adjustedPrice = enableGaps and time >= startDate ? closePrice - cumulativeGap : closePrice
    adjustedPrice

// Calculate gap-adjusted prices for each security
spyAdjusted = f_gapAdjustedPrice(spyClose, spyOpen, bWithoutGaps, gapStartDate)
qqqAdjusted = f_gapAdjustedPrice(qqqClose, qqqOpen, bWithoutGaps, gapStartDate)
xlpAdjusted = f_gapAdjustedPrice(xlpClose, xlpOpen, bWithoutGaps, gapStartDate)
xlyAdjusted = f_gapAdjustedPrice(xlyClose, xlyOpen, bWithoutGaps, gapStartDate)
iwdAdjusted = f_gapAdjustedPrice(iwdClose, iwdOpen, bWithoutGaps, gapStartDate)
iwfAdjusted = f_gapAdjustedPrice(iwfClose, iwfOpen, bWithoutGaps, gapStartDate)
djuAdjusted = f_gapAdjustedPrice(djuClose, djuOpen, bWithoutGaps, gapStartDate)
djtAdjusted = f_gapAdjustedPrice(djtClose, djtOpen, bWithoutGaps, gapStartDate)
djusscAdjusted = f_gapAdjustedPrice(djusscClose, djusscOpen, bWithoutGaps, gapStartDate)
spyvAdjusted = f_gapAdjustedPrice(spyvClose, spyvOpen, bWithoutGaps, gapStartDate)
spygAdjusted = f_gapAdjustedPrice(spygClose, spygOpen, bWithoutGaps, gapStartDate)
mdyvAdjusted = f_gapAdjustedPrice(mdyvClose, mdyvOpen, bWithoutGaps, gapStartDate)
mdygAdjusted = f_gapAdjustedPrice(mdygClose, mdygOpen, bWithoutGaps, gapStartDate)
ijsAdjusted = f_gapAdjustedPrice(ijsClose, ijsOpen, bWithoutGaps, gapStartDate)
ijtAdjusted = f_gapAdjustedPrice(ijtClose, ijtOpen, bWithoutGaps, gapStartDate)
iwnAdjusted = f_gapAdjustedPrice(iwnClose, iwnOpen, bWithoutGaps, gapStartDate)
iwoAdjusted = f_gapAdjustedPrice(iwoClose, iwoOpen, bWithoutGaps, gapStartDate)
customNumAdjusted = f_gapAdjustedPrice(customNumClose, customNumOpen, bWithoutGaps, gapStartDate)
customDenAdjusted = f_gapAdjustedPrice(customDenClose, customDenOpen, bWithoutGaps, gapStartDate)

// ========================================
// RATIO CALCULATIONS
// ========================================
ratioSPYQQQ = bInverseRatios ? (spyAdjusted != 0 ? qqqAdjusted / spyAdjusted : na) : (qqqAdjusted != 0 ? spyAdjusted / qqqAdjusted : na)
ratioXLPXLY = bInverseRatios ? (xlpAdjusted != 0 ? xlyAdjusted / xlpAdjusted : na) : (xlyAdjusted != 0 ? xlpAdjusted / xlyAdjusted : na)
ratioIWDIWF = bInverseRatios ? (iwdAdjusted != 0 ? iwfAdjusted / iwdAdjusted : na) : (iwfAdjusted != 0 ? iwdAdjusted / iwfAdjusted : na)
ratioDJUDJT = bInverseRatios ? (djuAdjusted != 0 ? djtAdjusted / djuAdjusted : na) : (djtAdjusted != 0 ? djuAdjusted / djtAdjusted : na)
ratioSPYDJUSSC = bInverseRatios ? (spyAdjusted != 0 ? djusscAdjusted / spyAdjusted : na) : (djusscAdjusted != 0 ? spyAdjusted / djusscAdjusted : na)
ratioSPYVSPYG = bInverseRatios ? (spyvAdjusted != 0 ? spygAdjusted / spyvAdjusted : na) : (spygAdjusted != 0 ? spyvAdjusted / spygAdjusted : na)
ratioMDYVMDYG = bInverseRatios ? (mdyvAdjusted != 0 ? mdygAdjusted / mdyvAdjusted : na) : (mdygAdjusted != 0 ? mdyvAdjusted / mdygAdjusted : na)
ratioIJSIJT = bInverseRatios ? (ijsAdjusted != 0 ? ijtAdjusted / ijsAdjusted : na) : (ijtAdjusted != 0 ? ijsAdjusted / ijtAdjusted : na)
ratioIWNIWO = bInverseRatios ? (iwnAdjusted != 0 ? iwoAdjusted / iwnAdjusted : na) : (iwoAdjusted != 0 ? iwnAdjusted / iwoAdjusted : na)
ratioCustom = bInverseRatios ? (customNumAdjusted != 0 ? customDenAdjusted / customNumAdjusted : na) : (customDenAdjusted != 0 ? customNumAdjusted / customDenAdjusted : na)

// ========================================
// SMA CALCULATIONS
// ========================================
smaSPYQQQ = ta.sma(ratioSPYQQQ, iSma)
smaXLPXLY = ta.sma(ratioXLPXLY, iSma)
smaIWDIWF = ta.sma(ratioIWDIWF, iSma)
smaDJUDJT = ta.sma(ratioDJUDJT, iSma)
smaSPYDJUSSC = ta.sma(ratioSPYDJUSSC, iSma)
smaSPYVSPYG = ta.sma(ratioSPYVSPYG, iSma)
smaMDYVMDYG = ta.sma(ratioMDYVMDYG, iSma)
smaIJSIJT = ta.sma(ratioIJSIJT, iSma)
smaIWNIWO = ta.sma(ratioIWNIWO, iSma)
smaCustom = ta.sma(ratioCustom, iSma)

// ========================================
// DETECT HOW MANY RATIOS ARE ENABLED
// ========================================
int ratioCount = 0
if bShowSPYQQQ
    ratioCount := ratioCount + 1
if bShowXLPXLY
    ratioCount := ratioCount + 1
if bShowIWDIWF
    ratioCount := ratioCount + 1
if bShowDJUDJT
    ratioCount := ratioCount + 1
if bShowSPYDJUSSC
    ratioCount := ratioCount + 1
if bShowSPYVSPYG
    ratioCount := ratioCount + 1
if bShowMDYVMDYG
    ratioCount := ratioCount + 1
if bShowIJSIJT
    ratioCount := ratioCount + 1
if bShowIWNIWO
    ratioCount := ratioCount + 1
if bShowCustom
    ratioCount := ratioCount + 1

bool singleRatio = ratioCount == 1

// ========================================
// PLOTTING - Each ratio with dynamic color
// ========================================
// SPY/QQQ
colorSPYQQQ = singleRatio ?
     (ratioSPYQQQ >= smaSPYQQQ ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioSPYQQQ >= smaSPYQQQ ? color.new(color.blue, 0) : color.new(color.blue, 60))
colorSMASPYQQQ = singleRatio ? color.new(color.blue, 0) : color.new(color.blue, 70)
plot(bShowSPYQQQ ? ratioSPYQQQ : na, color=colorSPYQQQ, title="SPY:QQQ", linewidth=2)
plot(bShowSPYQQQ and bShowSMA ? smaSPYQQQ : na, color=colorSMASPYQQQ, title="SPY:QQQ SMA", linewidth=1)

// XLP/XLY
colorXLPXLY = singleRatio ?
     (ratioXLPXLY >= smaXLPXLY ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioXLPXLY >= smaXLPXLY ? color.new(color.purple, 0) : color.new(color.purple, 60))
colorSMAXLPXLY = singleRatio ? color.new(color.blue, 0) : color.new(color.purple, 70)
plot(bShowXLPXLY ? ratioXLPXLY : na, color=colorXLPXLY, title="XLP:XLY", linewidth=2)
plot(bShowXLPXLY and bShowSMA ? smaXLPXLY : na, color=colorSMAXLPXLY, title="XLP:XLY SMA", linewidth=1)

// IWD/IWF
colorIWDIWF = singleRatio ?
     (ratioIWDIWF >= smaIWDIWF ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioIWDIWF >= smaIWDIWF ? color.new(color.green, 0) : color.new(color.green, 60))
colorSMAIWDIWF = singleRatio ? color.new(color.blue, 0) : color.new(color.green, 70)
plot(bShowIWDIWF ? ratioIWDIWF : na, color=colorIWDIWF, title="IWD:IWF", linewidth=2)
plot(bShowIWDIWF and bShowSMA ? smaIWDIWF : na, color=colorSMAIWDIWF, title="IWD:IWF SMA", linewidth=1)

// DJU/DJT
colorDJUDJT = singleRatio ?
     (ratioDJUDJT >= smaDJUDJT ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioDJUDJT >= smaDJUDJT ? color.new(color.orange, 0) : color.new(color.orange, 60))
colorSMADJUDJT = singleRatio ? color.new(color.blue, 0) : color.new(color.orange, 70)
plot(bShowDJUDJT ? ratioDJUDJT : na, color=colorDJUDJT, title="DJU:DJT", linewidth=2)
plot(bShowDJUDJT and bShowSMA ? smaDJUDJT : na, color=colorSMADJUDJT, title="DJU:DJT SMA", linewidth=1)

// SPY/DJUSSC
colorSPYDJUSSC = singleRatio ?
     (ratioSPYDJUSSC >= smaSPYDJUSSC ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioSPYDJUSSC >= smaSPYDJUSSC ? color.new(color.navy, 0) : color.new(color.navy, 60))
colorSMASPYDJUSSC = singleRatio ? color.new(color.blue, 0) : color.new(color.navy, 70)
plot(bShowSPYDJUSSC ? ratioSPYDJUSSC : na, color=colorSPYDJUSSC, title="SPY:DJUSSC", linewidth=2)
plot(bShowSPYDJUSSC and bShowSMA ? smaSPYDJUSSC : na, color=colorSMASPYDJUSSC, title="SPY:DJUSSC SMA", linewidth=1)

// SPYV/SPYG
colorSPYVSPYG = singleRatio ?
     (ratioSPYVSPYG >= smaSPYVSPYG ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioSPYVSPYG >= smaSPYVSPYG ? color.new(color.teal, 0) : color.new(color.teal, 60))
colorSMASPYVSPYG = singleRatio ? color.new(color.blue, 0) : color.new(color.teal, 70)
plot(bShowSPYVSPYG ? ratioSPYVSPYG : na, color=colorSPYVSPYG, title="SPYV:SPYG (S&P 500)", linewidth=2)
plot(bShowSPYVSPYG and bShowSMA ? smaSPYVSPYG : na, color=colorSMASPYVSPYG, title="SPYV:SPYG SMA", linewidth=1)

// MDYV/MDYG
colorMDYVMDYG = singleRatio ?
     (ratioMDYVMDYG >= smaMDYVMDYG ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioMDYVMDYG >= smaMDYVMDYG ? color.new(color.olive, 0) : color.new(color.olive, 60))
colorSMAMDYVMDYG = singleRatio ? color.new(color.blue, 0) : color.new(color.olive, 70)
plot(bShowMDYVMDYG ? ratioMDYVMDYG : na, color=colorMDYVMDYG, title="MDYV:MDYG (S&P 400)", linewidth=2)
plot(bShowMDYVMDYG and bShowSMA ? smaMDYVMDYG : na, color=colorSMAMDYVMDYG, title="MDYV:MDYG SMA", linewidth=1)

// IJS/IJT
colorIJSIJT = singleRatio ?
     (ratioIJSIJT >= smaIJSIJT ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioIJSIJT >= smaIJSIJT ? color.new(color.lime, 0) : color.new(color.lime, 60))
colorSMAIJSIJT = singleRatio ? color.new(color.blue, 0) : color.new(color.lime, 70)
plot(bShowIJSIJT ? ratioIJSIJT : na, color=colorIJSIJT, title="IJS:IJT (S&P 600)", linewidth=2)
plot(bShowIJSIJT and bShowSMA ? smaIJSIJT : na, color=colorSMAIJSIJT, title="IJS:IJT SMA", linewidth=1)

// IWN/IWO
colorIWNIWO = singleRatio ?
     (ratioIWNIWO >= smaIWNIWO ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioIWNIWO >= smaIWNIWO ? color.new(color.maroon, 0) : color.new(color.maroon, 60))
colorSMAIWNIWO = singleRatio ? color.new(color.blue, 0) : color.new(color.maroon, 70)
plot(bShowIWNIWO ? ratioIWNIWO : na, color=colorIWNIWO, title="IWN:IWO (Russell 2000)", linewidth=2)
plot(bShowIWNIWO and bShowSMA ? smaIWNIWO : na, color=colorSMAIWNIWO, title="IWN:IWO SMA", linewidth=1)

// Custom Ratio
string customLabelText = bInverseRatios ? sCustomDen + ":" + sCustomNum : sCustomNum + ":" + sCustomDen
colorCustom = singleRatio ?
     (ratioCustom >= smaCustom ? color.new(color.green, 0) : color.new(color.red, 0)) :
     (ratioCustom >= smaCustom ? color.new(color.fuchsia, 0) : color.new(color.fuchsia, 60))
colorSMACustom = singleRatio ? color.new(color.blue, 0) : color.new(color.fuchsia, 70)
plot(bShowCustom ? ratioCustom : na, color=colorCustom, title="Custom Ratio", linewidth=2)
plot(bShowCustom and bShowSMA ? smaCustom : na, color=colorSMACustom, title="Custom SMA", linewidth=1)

// ========================================
// LABELS AT LAST BAR
// ========================================
if bShowLabels and barstate.islast
    // Determine label text based on inverse setting
    labelSPYQQQ = bInverseRatios ? "QQQ:SPY" : "SPY:QQQ"
    labelXLPXLY = bInverseRatios ? "XLY:XLP" : "XLP:XLY"
    labelIWDIWF = bInverseRatios ? "IWF:IWD" : "IWD:IWF"
    labelDJUDJT = bInverseRatios ? "DJT:DJU" : "DJU:DJT"
    labelSPYDJUSSC = bInverseRatios ? "DJUSSC:SPY" : "SPY:DJUSSC"
    labelSPYVSPYG = bInverseRatios ? "SPYG:SPYV" : "SPYV:SPYG"
    labelMDYVMDYG = bInverseRatios ? "MDYG:MDYV" : "MDYV:MDYG"
    labelIJSIJT = bInverseRatios ? "IJT:IJS" : "IJS:IJT"
    labelIWNIWO = bInverseRatios ? "IWO:IWN" : "IWN:IWO"

    // Add gap-free indicator to label if enabled
    string gapSuffix = bWithoutGaps ? " [No Gaps]" : ""

    // Style map
    string styleLoc = label.style_label_left
    if sLabelStyle == "right"
        styleLoc := label.style_label_right
    
    // Size map
    string sizeLoc = size.small
    if sLabelSize == "tiny"
        sizeLoc := size.tiny
    else if sLabelSize == "normal"
        sizeLoc := size.normal
    else if sLabelSize == "large"
        sizeLoc := size.large
    else if sLabelSize == "huge"
        sizeLoc := size.huge

    if bShowSPYQQQ and not na(ratioSPYQQQ)
        label.new(bar_index, ratioSPYQQQ, text=labelSPYQQQ + gapSuffix, style=styleLoc, color=color.new(color.blue, 0), textcolor=color.white, size=sizeLoc)

    if bShowXLPXLY and not na(ratioXLPXLY)
        label.new(bar_index, ratioXLPXLY, text=labelXLPXLY + gapSuffix, style=styleLoc, color=color.new(color.purple, 0), textcolor=color.white, size=sizeLoc)

    if bShowIWDIWF and not na(ratioIWDIWF)
        label.new(bar_index, ratioIWDIWF, text=labelIWDIWF + gapSuffix, style=styleLoc, color=color.new(color.green, 0), textcolor=color.white, size=sizeLoc)

    if bShowDJUDJT and not na(ratioDJUDJT)
        label.new(bar_index, ratioDJUDJT, text=labelDJUDJT + gapSuffix, style=styleLoc, color=color.new(color.orange, 0), textcolor=color.white, size=sizeLoc)

    if bShowSPYDJUSSC and not na(ratioSPYDJUSSC)
        label.new(bar_index, ratioSPYDJUSSC, text=labelSPYDJUSSC + gapSuffix, style=styleLoc, color=color.new(color.navy, 0), textcolor=color.white, size=sizeLoc)

    if bShowSPYVSPYG and not na(ratioSPYVSPYG)
        label.new(bar_index, ratioSPYVSPYG, text=labelSPYVSPYG + gapSuffix, style=styleLoc, color=color.new(color.teal, 0), textcolor=color.white, size=sizeLoc)

    if bShowMDYVMDYG and not na(ratioMDYVMDYG)
        label.new(bar_index, ratioMDYVMDYG, text=labelMDYVMDYG + gapSuffix, style=styleLoc, color=color.new(color.olive, 0), textcolor=color.white, size=sizeLoc)

    if bShowIJSIJT and not na(ratioIJSIJT)
        label.new(bar_index, ratioIJSIJT, text=labelIJSIJT + gapSuffix, style=styleLoc, color=color.new(color.lime, 0), textcolor=color.white, size=sizeLoc)

    if bShowIWNIWO and not na(ratioIWNIWO)
        label.new(bar_index, ratioIWNIWO, text=labelIWNIWO + gapSuffix, style=styleLoc, color=color.new(color.maroon, 0), textcolor=color.white, size=sizeLoc)

    if bShowCustom and not na(ratioCustom)
        label.new(bar_index, ratioCustom, text=customLabelText + gapSuffix, style=styleLoc, color=color.new(color.fuchsia, 0), textcolor=color.white, size=sizeLoc)
